{% block content %}
<style>
    :root {
        --primary: #ffcc00;
        --primary-light: #ffdd33;
        --primary-dark: #e6b800;
        --dark: #121212;
        --dark-light: #242424;
        --text: #f5f5f5;
        --success: #00c853;
        --danger: #ff3d00;
    }

    body {
        background-color: var(--dark);
        color: var(--text);
        font-family: 'Roboto', sans-serif;
    }

    .inscription-container {
        max-width: 900px;
        margin: 30px auto;
        padding: 30px;
        background: linear-gradient(145deg, var(--dark), var(--dark-light));
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .form-section {
        background: rgba(255, 255, 255, 0.05);
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 25px;
        border-left: 4px solid var(--primary);
        transition: all 0.3s ease;
        animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    .form-section:hover {
        box-shadow: 0 5px 15px rgba(255, 204, 0, 0.2);
        transform: translateY(-3px);
    }

    h2, h3 {
        color: var(--primary);
        margin-bottom: 20px;
        position: relative;
        font-weight: 600;
    }

    h2::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 60px;
        height: 4px;
        background: var(--primary);
        border-radius: 2px;
    }

    label {
        display: block;
        margin: 15px 0 8px;
        font-weight: 500;
        color: var(--primary-light);
    }

    input[type="text"],
    input[type="tel"],
    input[type="email"],
    input[type="number"],
    select {
        width: 100%;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 204, 0, 0.3);
        border-radius: 8px;
        color: var(--text);
        font-size: 16px;
        transition: all 0.3s;
        margin-bottom: 15px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        cursor: pointer;
    }

    /* Add these new styles */
    select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ffcc00' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 16px;
        padding-right: 45px;
    }

    select option {
        background-color: var(--dark);
        color: var(--text);
        padding: 12px;
    }

    select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(255, 204, 0, 0.2);
    }

    select:hover {
        background-color: rgba(255, 255, 255, 0.15);
    }

    input:focus, select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(255, 204, 0, 0.2);
    }

    button {
        background: var(--primary);
        color: var(--dark);
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 10px;
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
    }

    button:hover {
        background: var(--primary-light);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3);
    }

    button:active {
        transform: translateY(0);
    }

    button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%);
        transform-origin: 50% 50%;
    }

    button:focus:not(:active)::after {
        animation: ripple 1s ease-out;
    }

    @keyframes ripple {
        0% {
            transform: scale(0, 0);
            opacity: 1;
        }
        20% {
            transform: scale(25, 25);
            opacity: 0.8;
        }
        100% {
            opacity: 0;
            transform: scale(50, 50);
        }
    }

    .players-container {
        max-height: 500px;
        overflow-y: auto;
        padding: 15px;
        scrollbar-width: thin;
        scrollbar-color: var(--primary) var(--dark);
    }

    .players-container::-webkit-scrollbar {
        width: 8px;
    }

    .players-container::-webkit-scrollbar-track {
        background: var(--dark);
        border-radius: 10px;
    }

    .players-container::-webkit-scrollbar-thumb {
        background-color: var(--primary);
        border-radius: 10px;
    }

    .player-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 12px;
        border: 1px solid rgba(255, 204, 0, 0.3);
        transition: all 0.3s;
        animation: fadeIn 0.5s ease-out;
        position: relative;
    }

    .player-card:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateX(3px);
    }

    .player-card h4 {
        color: var(--primary);
        margin-top: 0;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }

    .player-card h4::before {
        content: 'üèÉ';
        margin-right: 10px;
    }

    .player-card button {
        background: var(--danger);
        padding: 8px 15px;
        font-size: 14px;
        position: absolute;
        top: 15px;
        right: 15px;
    }

    .cost-summary {
        background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 204, 0, 0.15));
        padding: 25px;
        border-radius: 15px;
        margin-top: 30px;
        animation: pulseGlow 3s infinite alternate;
        border: 1px solid rgba(255, 204, 0, 0.3);
    }

    @keyframes pulseGlow {
        from { box-shadow: 0 0 10px rgba(255, 204, 0, 0.2); }
        to { box-shadow: 0 0 20px rgba(255, 204, 0, 0.4); }
    }

    .cost-summary p {
        display: flex;
        justify-content: space-between;
        margin: 8px 0;
        font-size: 16px;
    }

    .cost-summary p span {
        font-weight: 600;
        color: var(--primary);
    }

    .cost-summary p:last-child {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 204, 0, 0.3);
        font-size: 20px;
        font-weight: 700;
    }

    .file-upload {
        border: 2px dashed var(--primary);
        padding: 30px;
        text-align: center;
        border-radius: 15px;
        margin: 30px 0;
        transition: all 0.3s;
        background: rgba(255, 204, 0, 0.05);
        position: relative;
    }

    .file-upload:hover {
        background: rgba(255, 204, 0, 0.08);
        transform: scale(1.01);
    }

    .file-upload p {
        margin-bottom: 20px;
        color: var(--text);
    }

    .file-upload input[type="file"] {
        position: relative;
        z-index: 2;
        opacity: 0;
        width: 100%;
        height: 100px;
        cursor: pointer;
    }

    .file-upload label {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        text-align: center;
        transform: translateY(-50%);
        z-index: 1;
        pointer-events: none;
    }

    .file-upload-text {
        color: var(--primary);
        font-weight: 600;
        display: block;
        margin-top: 10px;
    }

    .hidden {
        display: none;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        margin: 15px 0;
    }

    .checkbox-group input[type="checkbox"] {
        margin-right: 10px;
        width: 20px;
        height: 20px;
        accent-color: var(--primary);
    }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
        background: linear-gradient(145deg, var(--dark), var(--dark-light));
        margin: 15% auto;
        padding: 30px;
        border: 2px solid var(--primary);
        border-radius: 15px;
        width: 80%;
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        animation: scaleIn 0.4s ease-out;
        text-align: center;
    }

    @keyframes scaleIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    .success-icon {
        font-size: 70px;
        color: var(--success);
        margin-bottom: 20px;
        display: block;
    }

    .modal h3 {
        margin-top: 0;
        color: var(--primary);
    }

    .modal p {
        margin: 20px 0;
        line-height: 1.6;
    }

    .modal button {
        padding: 12px 40px;
        margin-top: 20px;
    }
</style>

<div class="inscription-container">
    <h2>Inscripci√≥n de Equipo</h2>

    <form id="inscriptionForm" enctype="multipart/form-data">
        <div class="form-section">
            <h3>Informaci√≥n del Equipo</h3>

            <label for="categoria">Categor√≠a:</label>
            <select id="categoria" name="categoria" required>
                <option value="">Seleccione una categor√≠a</option>
                <option value="masculina">Masculina</option>
                <option value="femenina">Femenina</option>
            </select>

            <div id="deporteContainer" class="hidden">
                <label for="deporte">Deporte:</label>
                <select id="deporte" name="deporte" required>
                    <option value="">Seleccione un deporte</option>
                </select>
            </div>

            <div id="subcategoriaContainer" class="hidden">
                <label for="subcategoria">Subcategor√≠a:</label>
                <select id="subcategoria" name="subcategoria" required>
                    <option value="">Seleccione una subcategor√≠a</option>
                </select>
            </div>

            <label for="nombreEquipo">Nombre del Equipo:</label>
            <input type="text" id="nombreEquipo" name="nombreEquipo" required>
        </div>

        <div class="form-section">
            <h3>Informaci√≥n del Dirigente</h3>
            <label for="nombreDirigente">Nombre del Dirigente:</label>
            <input type="text" id="nombreDirigente" name="nombreDirigente" required>

            <label for="telefonoDirigente">Tel√©fono:</label>
            <input type="tel" id="telefonoDirigente" name="telefonoDirigente" required>

            <label for="emailDirigente">Email:</label>
            <input type="email" id="emailDirigente" name="emailDirigente" required>

            <div class="checkbox-group">
                <input type="checkbox" id="dirigenteJugador" name="dirigenteJugador">
                <label for="dirigenteJugador" style="display: inline-block; margin: 0;">
                    El dirigente tambi√©n es jugador
                </label>
            </div>
        </div>

        <div class="form-section">
            <h3>Jugadores</h3>
            <p>Agregue los jugadores a su equipo. Recuerde que debe registrar al menos 10 jugadores.</p>
            <div id="playersContainer" class="players-container">
                <!-- Players will be added here dynamically -->
            </div>
            <button type="button" id="addPlayer">+ Agregar Jugador</button>
        </div>

        <div class="cost-summary">
            <h3>Resumen de Costos</h3>
            <p>Jugadores registrados: <span id="totalPlayers">0</span></p>
            <p>Costo base (10 jugadores): <span>$120.00</span></p>
            <p>Costo por jugadores extra: <span>$<span id="extraCost">0.00</span></span></p>
            <p>Total a pagar: <span>$<span id="totalCost">120.00</span></span></p>
        </div>

        <div class="file-upload">
            <h3>Comprobante de Pago</h3>
            <p>Por favor, suba una imagen del comprobante de pago</p>
            <p>Asegurese de revisarla y enviar la correcta</p>

            <input type="file" id="comprobantePago" name="comprobantePago" accept="image/*" required>
            <label>
                <span class="file-upload-text">Arrastra tu archivo aqu√≠ o haz clic para seleccionar</span>
            </label>
        </div>

        <button type="submit">Completar Inscripci√≥n</button>
    </form>
</div>

<!-- Modal para confirmaci√≥n -->
<div id="confirmationModal" class="modal">
    <div class="modal-content">
        <span class="success-icon">‚úì</span>
        <h3>¬°Inscripci√≥n Enviada!</h3>
        <p>Su comprobante de pago ha sido recibido y ser√° revisado por nuestros administradores. Este proceso puede tardar hasta 24 horas. Una vez verificado, se registrar√° el pago.</p>
        <button id="confirmButton">Aceptar</button>
    </div>
</div>

<script>
const deportes = {
    masculina: ['F√∫tbol Sala', 'V√≥ley'],
    femenina: ['F√∫tbol Sala']
};

const subcategorias = {
    masculina: ['Abierta', '+40', '+50'],
    femenina: ['Abierta']
};

document.getElementById('categoria').addEventListener('change', function() {
    const deporteContainer = document.getElementById('deporteContainer');
    const deporteSelect = document.getElementById('deporte');
    const subcategoriaContainer = document.getElementById('subcategoriaContainer');
    const subcategoriaSelect = document.getElementById('subcategoria');

    deporteSelect.innerHTML = '<option value="">Seleccione un deporte</option>';
    subcategoriaSelect.innerHTML = '<option value="">Seleccione una subcategor√≠a</option>';

    if (this.value) {
        deporteContainer.classList.remove('hidden');
        subcategoriaContainer.classList.remove('hidden');

        deportes[this.value].forEach(deporte => {
            const option = document.createElement('option');
            option.value = deporte.toLowerCase();
            option.textContent = deporte;
            deporteSelect.appendChild(option);
        });

        subcategorias[this.value].forEach(subcategoria => {
            const option = document.createElement('option');
            option.value = subcategoria.toLowerCase();
            option.textContent = subcategoria;
            subcategoriaSelect.appendChild(option);
        });
    } else {
        deporteContainer.classList.add('hidden');
        subcategoriaContainer.classList.add('hidden');
    }
});

function addPlayer() {
    const container = document.getElementById('playersContainer');
    const playerCount = container.children.length;

    if (playerCount >= 30) {
        alert('Se ha alcanzado el l√≠mite m√°ximo de jugadores (30)');
        return;
    }

    const playerCard = document.createElement('div');
    playerCard.className = 'player-card';
    playerCard.innerHTML = `
        <h4>Jugador ${playerCount + 1}</h4>
        <input type="text" name="jugador[${playerCount}][nombre]" placeholder="Nombre completo" required>
        <input type="text" name="jugador[${playerCount}][cedula]" placeholder="N√∫mero de c√©dula" required>
        <input type="number" name="jugador[${playerCount}][numeroCamiseta]" placeholder="N√∫mero de camiseta" required>
        <button type="button" onclick="this.parentElement.remove(); updateCosts();">Eliminar</button>
    `;

    container.appendChild(playerCard);
    updateCosts();
}

function updateCosts() {
    const playerCount = document.getElementById('playersContainer').children.length;
    const extraPlayers = Math.max(0, playerCount - 10); // Changed from 20 to 10
    const extraCost = extraPlayers * 12; // Changed from 10 to 12
    const totalCost = 120 + extraCost; // Changed from 100 to 120

    document.getElementById('totalPlayers').textContent = playerCount;
    document.getElementById('extraCost').textContent = extraCost.toFixed(2);
    document.getElementById('totalCost').textContent = totalCost.toFixed(2);
}

// Mostrar el modal de confirmaci√≥n
function showConfirmationModal() {
    const modal = document.getElementById('confirmationModal');
    modal.style.display = 'block';
}

// Ocultar el modal de confirmaci√≥n
document.getElementById('confirmButton').addEventListener('click', function() {
    const modal = document.getElementById('confirmationModal');
    modal.style.display = 'none';
    window.location.href = '/inscripciones';
});

document.getElementById('addPlayer').addEventListener('click', addPlayer);

// Actualizar la etiqueta del input file cuando se selecciona un archivo
document.getElementById('comprobantePago').addEventListener('change', function() {
    const fileName = this.files[0]?.name || "Ning√∫n archivo seleccionado";
    const fileUploadText = this.parentElement.querySelector('.file-upload-text');
    fileUploadText.textContent = fileName;
});

document.getElementById('inscriptionForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const playerCount = document.getElementById('playersContainer').children.length;
    if (playerCount < 10) {
        alert('Debe registrar al menos 10 jugadores para completar la inscripci√≥n.');
        return;
    }

    try {
        const formData = new FormData();

        // Add form fields with correct names
        formData.append('categoria', document.getElementById('categoria').value);
        formData.append('deporte', document.getElementById('deporte').value);
        formData.append('subcategoria', document.getElementById('subcategoria').value);
        formData.append('nombreEquipo', document.getElementById('nombreEquipo').value);  // Add this line
        formData.append('nombreDirigente', document.getElementById('nombreDirigente').value);
        formData.append('telefonoDirigente', document.getElementById('telefonoDirigente').value);
        formData.append('emailDirigente', document.getElementById('emailDirigente').value);
        formData.append('dirigenteJugador', document.getElementById('dirigenteJugador').checked);

        // Add calculated values
        // Update the cost calculations
        formData.append('total_jugadores', playerCount);
        formData.append('monto_base', 120.0);
        formData.append('monto_extra', Math.max(0, playerCount - 10) * 12);
        formData.append('monto_total', 120.0 + Math.max(0, playerCount - 10) * 12);

        // Add file
        const fileInput = document.getElementById('comprobantePago');
        if (fileInput.files[0]) {
            formData.append('comprobantePago', fileInput.files[0]);
        }

        // Add players data
        const players = [];
        document.querySelectorAll('.player-card').forEach((card) => {
            players.push({
                nombre: card.querySelector('input[name$="[nombre]"]').value,
                cedula: card.querySelector('input[name$="[cedula]"]').value,
                numero_camiseta: card.querySelector('input[name$="[numeroCamiseta]"]').value
            });
        });
        formData.append('jugadores', JSON.stringify(players));

        // Send form data to server
        const response = await fetch('/inscripcion/guardar', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
        }

        const result = await response.json();

        if (result.success) {
            // Mostrar el modal de confirmaci√≥n en lugar de la alerta
            showConfirmationModal();
        } else {
            alert('Error al registrar la inscripci√≥n: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al procesar la inscripci√≥n: ' + error.message);
    }
});
</script>
{% endblock %}